# Podfile para Google Sign-In
platform :ios, '15.0'

target 'PINEE' do
  # Google Sign-In para autenticação real
  pod 'GoogleSignIn', '7.0.0'
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |config|
      if config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'].to_f < 12.0
        config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '12.0'
      end
      
      # Suprimir warnings de métodos deprecated no AppAuth (código de terceiros)
      if target.name == 'AppAuth'
        config.build_settings['WARNING_CFLAGS'] ||= []
        config.build_settings['WARNING_CFLAGS'] << '-Wno-deprecated-declarations'
      end
    end
  end
  
  # Garantir que o arquivo resources-to-copy existe com permissões corretas ANTES do build
  # Isso evita problemas de sandbox durante o build
  resources_file = File.join(installer.sandbox.root, "resources-to-copy-PINEE.txt")
  begin
    FileUtils.mkdir_p(File.dirname(resources_file)) unless File.directory?(File.dirname(resources_file))
    FileUtils.touch(resources_file) unless File.exist?(resources_file)
    File.chmod(0666, resources_file)
    # Garantir que o arquivo está vazio
    File.open(resources_file, 'w') { |f| f.write('') }
  rescue => e
    puts "⚠️ Aviso: Não foi possível criar #{resources_file}: #{e.message}"
    puts "   O arquivo será criado durante o build (pode gerar warnings de sandbox)"
  end
end